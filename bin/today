#!/usr/bin/env bash
#
# Author:
#   Newton (@chrisopedia)
#
# Description:
#   Creates/updates Today's todo list
#
# Dependencies:
#   None
#
# Configuration:
#   @param   file    required
#
# Usage:
#   `today task1`

_today() {
	local usage="$(basename "$0"): usage: $(basename "$0") [-d|--delete] [-e|--export [$(tput smul)file$(tput rmul)]] [-o|--open] $(tput smul)task$(tput rmul)"
	local date="$(date +"%m-%d-%y")"
	local dir file opt

	if [[ ! -z "${TODAY_DIRECTORY}" ]]; then
		dir="${TODAY_DIRECTORY}"
	else
		dir="${HOME}/Desktop"
	fi
	file="${dir}/TODAY-${date}.md"

	# Test for known flags
	for opt in $@
	do
		case $opt in
			-h|--help)
				printf "%s\n" "${usage}"
				exit
				;;
			-d|--delete)
				if [[ -f ${file} ]]; then
					rm "${file}"
					exit
				fi
				;;
			-o|--open)
				open "${file}"
				;;
			-*|--*) 
				printf 'bash: %s: %s: Invalid option\n' "$(basename "$0")" "$1"
				printf '%s\n' "$usage"
				exit
				;;
		esac
	done

	if [[ ! -f "${file}" ]]; then
		echo "# Today" >> ${file}
		echo >> ${file}
	fi

	echo "- [ ] ${@}" >> ${file}
}

_today "$@"
